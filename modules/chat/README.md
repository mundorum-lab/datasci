# Module ChatGPT

# Description
> This module has the function to explain some of the generated data to the final user using ChatGPT, in a way that makes it easy for them to understand the meaning of the data and provides insights that can contribute to their analysis. This module consists in two main components: The chat-button-oid and the chat-oid. The chat-button is responsible to interact with the user, make the requests to other parts of the framework and open a new tab with the prompt copied to the clipboard. This button is placed in the presentation template, along with each component generated by the workflow. That way, by clicking on the chat-button next to some component, it requests a customized prompt to that component and opens a new tab to OpenAI with the copied prompt. The chat-oid component is responsible to the logic behind the requests. First, it subscribes to the topic exportWorkflow~graph so it receives the full workflow state once its ready. Later, it connects to the chat-button by the interface "chat" and the operation "connect" and gets the id of the component that the user wants to understand. Then, it searches the workflow to find the component and retrieve its dat. After that, it gets all the previous components that are connected to it somehow, in a way that it creates the whole context of the experiment so it can generate a better prompt. The connections to each component are done with getters through the interface "oid" and the operation "get". Finally, the generated prompt is sent to the chat-button through the interface "chat" and operation "prompt" so it can be copied to the clipboard.

# Team
* `JoÃ£o Vitor Baptista Moreira`
* `Felipe Pacheco Manoel`

# Message Types


**ValidTable**
~~~json
{
  "columns" : [{"name":string,"type":string}],
  "data" : [[any]]
}
~~~

**SingleValue**
~~~json~~~
{
  "value": any
}
~~~

**WorkflowState**
~~~json
{
  "nodes": [{
    "nodeId": int,
    "nodeType": string,
    "attributes": {...}
  }],

  "edges" : [[int, int],[int, int], ...]
}

~~~

# Components

## Component chat-button-oid

> The chat-button is responsible to interact with the user, make the requests to other parts of the framework and open a new tab with the prompt copied to the clipboard. This button is placed in the presentation template, along with each component generated by the workflow. That way, by clicking on the chat-button next to some component, it requests a customized prompt to that component and opens a new tab to OpenAI with the copied prompt. Its template is based on the button-oid. That way, clicking on the button makes it send a notice to itself by the bus, so it is always subscribes on the chat/explain~explain topic, generated by the button oid inside it.

### Properties

property | role
---------| --------
`id` | unique identifier of the component,relative to the workflow, it let the component find itself in the workflow

### Input Notices

notice | action | message type
-------| ------ | ------------
`receiveId` | stores the component Id to search the workflow to find relevant nodes | SingleValue
> Obs: this notice was implemented, however the id can be passed directly through a parameter if the presentation prefers that way

### Output Notices

notice    | source | message type
----------| -------| ------------
copyAndOpenChatGPT | copy the generated prompt to the clipboard and opens a new window to openAI | ---

## Setup

~~~html
<chat-button-oid subscribe="chat/explain~explain" componentId="<insert componentId here or subscribe to topic with receiveId>" >
</chat-button-oid>

~~~

## Component chat-oid

> The chat-oid component is responsible to the logic behind the requests. First, it subscribes to the topic exportWorkflow~graph so it receives the full workflow state once its ready. Later, it connects to the chat-button by the interface "chat" and the operation "connect" and gets the id of the component that the user wants to understand. Then, it searches the workflow to find the component and retrieve its dat. After that, it gets all the previous components that are connected to it somehow, in a way that it creates the whole context of the experiment so it can generate a better prompt. The connections to each component are done with getters through the interface "oid" and the operation "get". Finally, the generated prompt is sent to the chat-button through the interface "chat" and operation "prompt" so it can be copied to the clipboard.

### Properties

property | role
---------| --------
`workflowState` | stores the workflowState received from the workflow

### Input Notices

notice | action | message type
-------| ------ | ------------
`graph`| receives the workflowstate graph by the bus | WorkflowState
`get`| gets the data of the relevant components of the workflow through the interface "oid"| ValidTable or SingleValue

### Output Notices

notice    | source | message type
----------| -------| ------------
`prompt` | provides the generated prompt customized by the current workflow state through the interface "chat" and operation "prompt" | SingleValue

### Interface chat
 operation | description |cardinality 
 ----------| ------------|-----------
 `prompt`| provides the generated prompt customized by the current workflow state | 1:n
 `connect`| connects to the other components using the standard interface "itf:oid" | 1:n

## Setup

~~~html

<chat-oid subscribe="exportWorkflow~graph" id="chat">
</chat-oid>

~~~

# Components Narratives

## Narrative

* The chat-oid component subscribes to the topic "workflowState", which has a map of all the connections made.
* The chat-button-oid is placed in each presentation module
* When a button is clicked, the chat button calls the chat-oid and provides the component id
* Then, the component searches int the workflow for the full path until the node the user would like to explain.
* Then, it will send getters to the component to retrieve their data.
* After receiving all of them by the proper id by the interface oid, it will generate the prompt
* Then, the response returns to the chat button with the interface
* Finally, the chat button copies the prompt to the clipboard, sending an alert and opens a new tab to chatGPT

## Example

* The index.html file can be used as an example
* The integration with a mock of the workflow can be seen in this file, also the value received can be seen in console.
* The integration with transform and graph components should be seen too, however it is not working properly yet.
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Integration</title>
  <script src="../index.js" type="module"></script>
  <script src="../../data/src/components/apiinput-oid.js" type="module"></script>
  <script src="../../data/src/components/typeinput-oid.js" type="module"></script>
  <script src="../../data/src/components/table-view-oid.js" type="module"></script>
</head>
<body>  
  

  <div id="api_data">
    IDENTIFIER: <input id='identifier' type='text' value="api_test_123"><br>
    API URL: <input id='api_url' type='text' value="https://jsonplaceholder.typicode.com/posts"><br>
    METHOD: <input id="method" type="text" value="GET"><br>
    BODY: <br><textarea id="body" cols="50" rows="10"></textarea><br>
    HEADERS: <br><textarea id="headers" cols="50" rows="10"></textarea>
  </div>
  <button-oid id="send-button" label="Send request"
              value="{'api_url':'','method':'','headers':'','body':''}"
              publish="click~transform/to_input_api">
  </button-oid>
  <value-to-raw publish="output-raw~transformed/to_input_api" subscribe="transform/to_input_api~transform"></value-to-raw>
  <api-input subscribe="transformed/to_input_api~input_api" publish="output~data/raw"></api-input>
  
  <type-input subscribe="data/raw~type_input" publish="output_type~data/processed"></type-input>

  <ml-lr-oid target_index="1" subscribe="data/processed~transform" publish="transformed~data/transformed"></ml-lr-oid>

  <table-view-oid subscribe="data/transformed~display"></table-view-oid>

  <script>
    var apiIdentifier = document.getElementById("identifier");
    var apiUrlInput = document.getElementById("api_url");
    var methodInput = document.getElementById("method");
    var bodyInput = document.getElementById("body");
    var headersInput = document.getElementById("headers");

    var sendButton = document.getElementById('send-button');

    for (let i of [apiUrlInput, methodInput, bodyInput, headersInput, apiIdentifier]) {
      i.addEventListener("input", updateSendButtonData);
    }

    document.addEventListener('DOMContentLoaded', updateSendButtonData);

    function updateSendButtonData() {
      try {
        const requestData = {
          api_url: apiUrlInput.value,
          method: methodInput.value,
          headers: headersInput.value,
          body: bodyInput.value,
          identifier: apiIdentifier.value
        };

        const jsonString = JSON.stringify(requestData);
        sendButton.setAttribute('value', jsonString);

        console.log("Updated button data - " + sendButton.value);
      } catch (error) {
        console.error('Error updating button data:', error);
      }
    }
  </script>
</body>
</html>
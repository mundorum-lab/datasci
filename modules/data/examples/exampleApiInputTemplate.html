<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Example Template</title>
    <script src="../src/components/apiinput-oid.js" type="module"></script>
    <script src="../src/components/json-parser-oid.js" type="module"></script>
    <script src="../src/components/value-to-raw-oid.js" type="module"></script>
  </head>
  <body>
    <h1>Api-input Component</h1>
    <div id="api_data">
      IDENTIFIER: <input id='identifier' type='text' value="api_test_123"><br>
      API URL: <input id='api_url' type='text' value="https://jsonplaceholder.typicode.com/posts"><br>
      METHOD: <input id="method" type="text" value="GET"><br>
      BODY: <br><textarea id="body" cols="50" rows="10"></textarea><br>
      HEADERS: <br><textarea id="headers" cols="50" rows="10"></textarea>
    </div>
    <button-oid id="send-button" label="Send request"
                value="{'api_url':'','method':'','headers':'','body':''}"
                publish="click~transform/to_input_api">
    </button-oid>
    <api-input subscribe="transformed/to_input_api~input_api" publish="output~transformed/raw_api"></api-input>
    <json-parser subscribe="transformed/raw_api~input_raw" publish="output_processed~detransform/to_console"></json-parser>
    <value-to-raw publish="output-raw~transformed/to_input_api;output-value~detransformed/to_console"
                      subscribe="transform/to_input_api~transform;detransform/to_console~detransform">
    </value-to-raw>
    <console-oid subscribe="detransformed/to_console~display"></console-oid>

    <script>
      var apiIdentifier = document.getElementById("identifier");
      var apiUrlInput = document.getElementById("api_url");
      var methodInput = document.getElementById("method");
      var bodyInput = document.getElementById("body");
      var headersInput = document.getElementById("headers");

      var sendButton = document.getElementById('send-button');

      for (let i of [apiUrlInput, methodInput, bodyInput, headersInput, apiIdentifier]) {
        i.addEventListener("input", updateSendButtonData);
      }

      document.addEventListener('DOMContentLoaded', updateSendButtonData);

      function updateSendButtonData() {
        try {
          const requestData = {
            api_url: apiUrlInput.value,
            method: methodInput.value,
            headers: headersInput.value,
            body: bodyInput.value,
            identifier: apiIdentifier.value
          };

          const jsonString = JSON.stringify(requestData);
          sendButton.setAttribute('value', jsonString);

          console.log("Updated button data - " + sendButton.value);
        } catch (error) {
          console.error('Error updating button data:', error);
        }
      }
    </script>
  </body>
</html>
